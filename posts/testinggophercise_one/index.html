<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Gophercise 1 | Bargsteen</title>
    <meta name="description" content="I write about stuff.">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/prism-nord.css" rel="stylesheet">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Bargsteen">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Bargsteen">
    <script>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    </script>
  </head>
  <body>

    <script type="text/javascript">
      (function(window, document, dataLayerName, id) {
        window[dataLayerName]=window[dataLayerName]||[],window[dataLayerName].push({start:(new Date).getTime(),event:"stg.start"});var scripts=document.getElementsByTagName('script')[0],tags=document.createElement('script');
        function stgCreateCookie(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toUTCString()}document.cookie=a+"="+b+d+"; path=/"}
        var isStgDebug=(window.location.href.match("stg_debug")||document.cookie.match("stg_debug"))&&!window.location.href.match("stg_disable_debug");stgCreateCookie("stg_debug",isStgDebug?1:"",isStgDebug?14:-1);
        var qP=[];dataLayerName!=="dataLayer"&&qP.push("data_layer_name="+dataLayerName),isStgDebug&&qP.push("stg_debug");var qPString=qP.length>0?("?"+qP.join("&")):"";
        tags.async=!0,tags.src="https://bargsteen.containers.piwik.pro/"+id+".js"+qPString,scripts.parentNode.insertBefore(tags,scripts);
        !function(a,n,i){a[n]=a[n]||{};for(var c=0;c<i.length;c++)!function(i){a[n][i]=a[n][i]||{},a[n][i].api=a[n][i].api||function(){var a=[].slice.call(arguments,0);"string"==typeof a[0]&&window[dataLayerName].push({event:n+"."+i+":"+a[0],parameters:[].slice.call(arguments,1)})}}(i[c])}(window,"ppms",["tm","cm"]);
      })(window, document, 'dataLayer', '88433787-bc55-4177-8521-e4b4a01020a8');
    </script><noscript><iframe src="https://bargsteen.containers.piwik.pro/88433787-bc55-4177-8521-e4b4a01020a8/noscript.html" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div class="flex flex-col min-h-screen min-h-screen-ios">
      <header class="bg-gray-200 dark:bg-gray-900">
        <div class="flex flex-col sm:flex-row gap-y-3 mx-auto p-6 justify-between max-w-4xl">
          <div class="text-center">
            <h1 class="text-4xl sm:text-5xl font-sans font-bold dark:text-white dark:hover:text-indigo-600 hover:text-indigo-600 my-auto transition duration-100 ease-out"><a href="/">Bargsteen</a></h1>
          </div>
          <nav class="flex flex-row justify-center">
            <h1 class="underline dark:text-white dark:hover:text-indigo-600 hover:text-indigo-600 mx-4 my-auto text-xl font-semibold transition duration-100 ease-out"><a href="/">Home</a></h1>
            <h1 class="underline dark:text-white dark:hover:text-indigo-600 hover:text-indigo-600 mx-4 my-auto text-xl font-semibold transition duration-100 ease-out"><a href="/about">About</a></h1>
            <button onclick="toggleDarkMode()" class="focus:outline-none dark:text-white w-6 hover:text-indigo-600 dark:hover:text-indigo-600 mx-4 my-auto">
              <div class="dark:hidden">
                <!-- Moon -->
                <svg className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                </svg>
              </div>
              <div class="hidden dark:inline">
                <!-- Sun -->
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clipRule="evenodd" />
                </svg>
              </div>
            </button>
          </nav>
        </div>
      </header>

      <main class="flex-grow dark:bg-gray-800 pt-8 px-3 md:px-0 markdown">
          <h1>Testing Gophercise 1</h1>
<p>I recently started programming in Go via <a href="http://tour.golang.org/">The Tour of Go</a> and I was delighted to find it fun and easy to get in to. Go is a perfect example of how powerful simplicity can be.
After learning the basics, including the very interesting concurrency primitives, I decided to look for projects to build and luckily stumbled upon <a href="http://gophercises.com">Gophercises</a>, which is a free set of tutorials based on Go, where you build small, but realistic and useful, projects and thereafter can watch a professional Go-programmer code the same project. After completing <a href="https://gophercises.com/exercises/quiz">the first exercise, where you build a quiz game</a>, I decided to try and test the code as a way of learning testing in Go. It should be stated that I do not have a great deal of experience in testing code (and none in Go so far), but am currently taking a course on testing and verification. The goal of this post will therefore be to further my knowledge of testing in Go, and in general, whilst explaining it to whomever might read this.</p>
<h2>The Starting Point: 0% Test Coverage</h2>
<p>To make it easier for others to follow, we will base the tests upon the <a href="https://github.com/gophercises/quiz/tree/solution-p2">official solution provided by the creator of Gophercises</a>. And as an indicator of our progress, we will use the <a href="https://blog.golang.org/cover">Go Cover Tool</a>.  Obviously, we start out at 0% coverage. But we will soon make amends to that number,  hopefully arriving at a 100% without too many alterrations to the code.</p>
<p>Once a test file is created, which needs the suffix <code>_text</code> i.e. the tests for <code>main.go</code> are expected to be in the file <code>main_test.go</code>, you can check the test coverage. This is done by running the command <code>go test -cover</code>.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>	“encoding<span class="token operator">/</span>csv”<br>	“flag”<br>	“fmt”<br>	“os”<br>	“strings”<br>	“time”<br><span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	csvFilename <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>“csv”<span class="token punctuation">,</span> “problems<span class="token punctuation">.</span>csv”<span class="token punctuation">,</span> “a csv file in the format of ‘question<span class="token punctuation">,</span>answer’”<span class="token punctuation">)</span><br>	timeLimit <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>“limit”<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> “the time limit <span class="token keyword">for</span> the quiz in seconds”<span class="token punctuation">)</span><br>	flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token operator">*</span>csvFilename<span class="token punctuation">)</span><br>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>		<span class="token function">exit</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>“Failed to open the CSV file<span class="token punctuation">:</span> <span class="token operator">%</span>s\n”<span class="token punctuation">,</span> <span class="token operator">*</span>csvFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br>	r <span class="token operator">:=</span> csv<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><br>	lines<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>		<span class="token function">exit</span><span class="token punctuation">(</span>“Failed to parse the provided CSV file<span class="token punctuation">.</span>”<span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br>	problems <span class="token operator">:=</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><br><br>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span><span class="token operator">*</span>timeLimit<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br>	correct <span class="token operator">:=</span> <span class="token number">0</span><br><br>problemloop<span class="token punctuation">:</span><br>	<span class="token keyword">for</span> i<span class="token punctuation">,</span> p <span class="token operator">:=</span> <span class="token keyword">range</span> problems <span class="token punctuation">{</span><br>		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Problem #%d: %s = "</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>q<span class="token punctuation">)</span><br>		answerCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span><br>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token keyword">var</span> answer <span class="token builtin">string</span><br>			fmt<span class="token punctuation">.</span><span class="token function">Scanf</span><span class="token punctuation">(</span>“<span class="token operator">%</span>s\n”<span class="token punctuation">,</span> <span class="token operator">&amp;</span>answer<span class="token punctuation">)</span><br>			answerCh <span class="token operator">&lt;-</span> answer<br>		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>		<span class="token keyword">select</span> <span class="token punctuation">{</span><br>		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C<span class="token punctuation">:</span><br>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>			<span class="token keyword">break</span> problemloop<br>		<span class="token keyword">case</span> answer <span class="token operator">:=</span> <span class="token operator">&lt;-</span>answerCh<span class="token punctuation">:</span><br>			<span class="token keyword">if</span> answer <span class="token operator">==</span> p<span class="token punctuation">.</span>a <span class="token punctuation">{</span><br>				correct<span class="token operator">++</span><br>			<span class="token punctuation">}</span><br>		<span class="token punctuation">}</span><br>	<span class="token punctuation">}</span><br><br>	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span>“You scored <span class="token operator">%</span>d out of <span class="token operator">%</span>d<span class="token punctuation">.</span>\n”<span class="token punctuation">,</span> correct<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>problems<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>lines <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>problem <span class="token punctuation">{</span><br>	ret <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token operator">:=</span> <span class="token keyword">range</span> lines <span class="token punctuation">{</span><br>		ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> problem<span class="token punctuation">{</span><br>			q<span class="token punctuation">:</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>			a<span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">return</span> ret<br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> problem <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>	q <span class="token builtin">string</span><br>	a <span class="token builtin">string</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">exit</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><br>	os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h2>First Unittest</h2>
<p>Let’s get our feet wet with the <code>parseLines</code> function. It should be relatively simple, as it is a pure function (i.e. it has no side-effects). Okay, so first of all we need to import the <code>testing</code> library, and all of our testing functions will take <code>*testing.T</code> as the sole input. If you have experience with testing in something like Python or Java, you’ll notice the lack of the <code>assert</code> keyword. This is done purposefully by the creators of Go to make writing testcode more similar to regular code. Instead of asserts you use regular if-statements together with some of the functions from the testing library. Here is the first version of the test for the <code>parseLines</code> function:</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token string">"testing"</span><br><br><span class="token keyword">func</span> <span class="token function">TestParseLines</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  tables <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span><br>  input    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><br>  expected <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<br>  <span class="token punctuation">}</span><span class="token punctuation">{</span><br>    <span class="token punctuation">{</span><br>      input<span class="token punctuation">:</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string1<span class="token punctuation">,</span><br>      expected<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">3</span>”<span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">4</span> <span class="token operator">/</span> <span class="token number">2</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">2</span>”<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>      input<span class="token punctuation">:</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string10<span class="token punctuation">,</span><br>      expected<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">10</span> <span class="token operator">%</span> <span class="token number">3</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">1</span>”<span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token punctuation">(</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">50</span>”<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> table <span class="token operator">:=</span> <span class="token keyword">range</span> tables <span class="token punctuation">{</span><br>    actual <span class="token operator">:=</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>input<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>expected<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>“Failed to parse all lines<span class="token punctuation">.</span>”<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> actual <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> a <span class="token operator">!=</span> table<span class="token punctuation">.</span>expected<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span><br>        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>“The following line caused problems with parsing<span class="token punctuation">:</span> <span class="token operator">%</span>v”<span class="token punctuation">,</span> table<span class="token punctuation">.</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>I used test tables to allow for easily adding more test cases in the future, similar to how  <a href="https://xunit.github.io/docs/getting-started/netcore/cmdline#write-first-theory">theories work in something like xUnit</a>. As with the lack of assertions, this approach relies only on regular language constructs such as lists and structs. It brings our test-coverage up to 12.5%, but I see a possibility of runtime-errors; what happens if you pass in the following input? <code>[][]string4</code>. It causes a panic, because <code>parseLines</code> assumes the inner lists to have a length of two. <code>parseLines</code> should therefore return an <code>([]problem, error)</code> tuple instead, and we will have to alter the code and the tests.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">var</span> errProblemFormat <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>“invalid problem format”<span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>lines <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  ret <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token operator">:=</span> <span class="token keyword">range</span> lines <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errProblemFormat<br>    <span class="token punctuation">}</span><br>    ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> problem<span class="token punctuation">{</span><br>      q<span class="token punctuation">:</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      a<span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> ret<span class="token punctuation">,</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre>
<p>To handle the possibility of errors, the <code>main</code> function now checks whether the returned error from <code>parseLines</code> is nil.
The final tests</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">TestParseLines</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  tables <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    input         <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><br>    shouldSucceed <span class="token builtin">bool</span><br>    expected      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<br>  <span class="token punctuation">}</span><span class="token punctuation">{</span><br>    <span class="token punctuation">{</span><br>      input<span class="token punctuation">:</span>         <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string1<span class="token punctuation">,</span><br>      shouldSucceed<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      expected<span class="token punctuation">:</span>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">3</span>”<span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">4</span> <span class="token operator">/</span> <span class="token number">2</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">2</span>”<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      input<span class="token punctuation">:</span>         <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string10<span class="token punctuation">,</span><br>      shouldSucceed<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      expected<span class="token punctuation">:</span>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token number">10</span> <span class="token operator">%</span> <span class="token number">3</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">1</span>”<span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> “<span class="token punctuation">(</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span>”<span class="token punctuation">,</span> a<span class="token punctuation">:</span> “<span class="token number">50</span>”<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      input<span class="token punctuation">:</span>         <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string10<span class="token punctuation">,</span><br>      shouldSucceed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      expected<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> table <span class="token operator">:=</span> <span class="token keyword">range</span> tables <span class="token punctuation">{</span><br>    actual<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>input<span class="token punctuation">)</span><br><br>    <span class="token comment">// Valid, but fails</span><br>    <span class="token keyword">if</span> table<span class="token punctuation">.</span>shouldSucceed <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>      t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>“Failed to parse all lines<span class="token punctuation">:</span> <span class="token operator">%</span>v”<span class="token punctuation">,</span> table<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> actual <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> a <span class="token operator">!=</span> table<span class="token punctuation">.</span>expected<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span><br>        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>“The following line was parsed incorrectly<span class="token punctuation">:</span> <span class="token operator">%</span>v”<span class="token punctuation">,</span> table<span class="token punctuation">.</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>According to the cover tool, this alteration brings us up to 16.7% test coverage due to the increased length of the function under test.</p>
<h2>Breaking Main Apart</h2>
<p>Rather than testing the <code>main</code> function in its current, bulky, state I decided to refactor it a bit. Primarily to bring out the non-trivial parts.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  csvFilename <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"csv"</span><span class="token punctuation">,</span> <span class="token string">"problems.csv"</span><span class="token punctuation">,</span> <span class="token string">"a csv file in the format of 'question,answer'"</span><span class="token punctuation">)</span><br>  timeLimit <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">"limit"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">"the time limit for the quiz in seconds"</span><span class="token punctuation">)</span><br>  flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>  file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token operator">*</span>csvFilename<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>    <span class="token function">exit</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Failed to open the CSV file: %s\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>csvFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  r <span class="token operator">:=</span> csv<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><br>  lines<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"Failed to read the provided CSV file."</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  problems<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">parseLines</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"Failed to parse one of the lines in the CSV file."</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  correct<span class="token punctuation">,</span> total <span class="token operator">:=</span> <span class="token function">runQuiz</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> problems<span class="token punctuation">,</span> <span class="token operator">*</span>timeLimit<span class="token punctuation">)</span><br>  <span class="token function">printResult</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> correct<span class="token punctuation">,</span> total<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">runQuiz</span><span class="token punctuation">(</span>r io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> w io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> problems <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">,</span> timeLimit <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>correct<span class="token punctuation">,</span> total <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>timeLimit<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br>  total <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>problems<span class="token punctuation">)</span><br><br>problemloop<span class="token punctuation">:</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> p <span class="token operator">:=</span> <span class="token keyword">range</span> problems <span class="token punctuation">{</span><br>    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Problem #%d: %s = "</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>q<span class="token punctuation">)</span><br>    answerCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span><br>    <span class="token keyword">go</span> <span class="token function">getAndSendAnswer</span><span class="token punctuation">(</span>answerCh<span class="token punctuation">,</span> r<span class="token punctuation">)</span><br><br>    <span class="token keyword">select</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C<span class="token punctuation">:</span><br>      fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><br>      <span class="token keyword">break</span> problemloop<br>    <span class="token keyword">case</span> answer <span class="token operator">:=</span> <span class="token operator">&lt;-</span>answerCh<span class="token punctuation">:</span><br>      <span class="token keyword">if</span> answer <span class="token operator">==</span> p<span class="token punctuation">.</span>a <span class="token punctuation">{</span><br>        correct<span class="token operator">++</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> correct<span class="token punctuation">,</span> total<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">printResult</span><span class="token punctuation">(</span>w io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> correct<span class="token punctuation">,</span> total <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"You scored %d out of %d.\n"</span><span class="token punctuation">,</span> correct<span class="token punctuation">,</span> total<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">getAndSendAnswer</span><span class="token punctuation">(</span>answerCh <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> r io<span class="token punctuation">.</span>Reader<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> answer <span class="token builtin">string</span><br>  fmt<span class="token punctuation">.</span><span class="token function">Fscanf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>answer<span class="token punctuation">)</span><br>  answerCh <span class="token operator">&lt;-</span> answer<br><span class="token punctuation">}</span></code></pre>
<p>Aside from extracting some of the functionality, I removed the direct use of standard in and out, which <code>fmt.Printf</code> and friends rely on. Instead we use the related <code>fmt.Fprintf</code> and <code>fmt.Fscanf</code> functions which take in an <code>io.Writer</code> and <code>io.Reader</code>, respectively. When used in the program, we can pass in <code>os.stdout</code> and <code>os.stdin</code>, and during tests we can choose to give it something completely different. The use of interfaces in Go is common because they are very flexible. The key difference between interfaces in Go and fx C# is that you don’t have to specify which interfaces you implement when creating the data structures (would be classes in C#). Instead, if functions exist for a given data structure, which adheres to an interface—even one you /just/ created—then the data structure implements that interface!</p>
<p>Okay, back to testing; how do we proceed? <code>parseLines</code> was rather trivial, as it was a pure function without concurrency. <code>getAndSendAnswer</code> is the exact opposite, but it turns out to be easy to test due to its reliance on its inputs. We can fake the userinput using <code>strings.NewReader</code> and listen on the channel, just like the caller in actual code would.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">TestGetAndSendAnswer</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  answerCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span><br>  <span class="token keyword">go</span> <span class="token function">getAndSendAnswer</span><span class="token punctuation">(</span>answerCh<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>“<span class="token number">42</span>\n43\n”<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> msg <span class="token operator">:=</span> <span class="token operator">&lt;-</span>answerCh<span class="token punctuation">;</span> msg <span class="token operator">!=</span> “<span class="token number">42</span>” <span class="token punctuation">{</span><br>    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>“received incorrect answer from channel”<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The newline characters (<code>\n</code>) are important, as the <code>fmt.Fscanf</code> call in <code>runQuiz</code> expects it between each answer. Notice the <code>go</code> keyword before <code>getAndSendAnswer</code>; I forgot it the first time around which caused a deadlock. The lesson learned: when testing functions used a goroutines, remember to also use the <code>go</code> keyword in your tests, as the results might be completely different.</p>
<p>And now for the final part that I decided to test. The <code>runQuiz</code> function. Since it deals with a <code>Timer</code>, I had to create my own <code>Reader</code> type, which sleeps in between reads. It could definitely have been achieved in a different and more elegant fashion, which wouldn’t delay the execution of the tests, but this will serve for now. It is basically a wrapper around the <code>strings.NewReader</code>:</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> slowReader <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>  r     io<span class="token punctuation">.</span>Reader<br>  delay <span class="token builtin">int</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>sr slowReader<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  n<span class="token punctuation">,</span> err <span class="token operator">:=</span> sr<span class="token punctuation">.</span>r<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><br>  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span>delay<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n<span class="token punctuation">,</span> err<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">makeSlowReader</span><span class="token punctuation">(</span>text <span class="token builtin">string</span><span class="token punctuation">,</span> delay <span class="token builtin">int</span><span class="token punctuation">)</span> slowReader <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> slowReader<span class="token punctuation">{</span>r<span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> delay<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Once again, I use test tables to check multiple cases. Oh, and <code>io.Discard</code> is an implementation of <code>io.Writer</code> which throws everything written to it, as we don’t need it for the tests.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">TestRunQuiz</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  tables <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    readerText      <span class="token builtin">string</span><br>    problems        <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<br>    expectedCorrect <span class="token builtin">int</span><br>    timeLimit       <span class="token builtin">int</span><br>    readerDelay     <span class="token builtin">int</span><br>  <span class="token punctuation">}</span><span class="token punctuation">{</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"3\n2\n"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"1 + 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"4 / 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"2\n1\n"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"1 + 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"4 / 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"  3  \n  2  \n"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"1 + 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"4 / 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"3\n2\n"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"1 + 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"4 / 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"3\n2\n"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token punctuation">]</span>problem<span class="token punctuation">{</span>problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"1 + 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> problem<span class="token punctuation">{</span>q<span class="token punctuation">:</span> <span class="token string">"4 / 2"</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tables <span class="token punctuation">{</span><br>    actualCorrect<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">runQuiz</span><span class="token punctuation">(</span><span class="token function">makeSlowReader</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>readerText<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>readerDelay<span class="token punctuation">)</span><span class="token punctuation">,</span> ioutil<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>problems<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>timeLimit<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> actualCorrect <span class="token operator">!=</span> tt<span class="token punctuation">.</span>expectedCorrect <span class="token punctuation">{</span><br>      t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Failed on table %d. Expected: %d. Actual: %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>expectedCorrect<span class="token punctuation">,</span> actualCorrect<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The final test coverage is on 53.8% which is due to the lack of tests on <code>main</code>, but given the nature of the code I deem it satisfying. Something else which is satisfying, is the /heat map/ you can generate of your code based on the test coverage.
::TODO INSERT IMAGE::
It gives you clear insights into which lines are tested, and how thoroughly, which is very cool indeed.</p>
<h2>What did we learn?</h2>
<p>To round this post of, let’s reflect a bit on what we learned.</p>
<ul>
<li> How to create and execute basic tests in Go</li>
<li> How to use test tables in tests</li>
<li> How to test goroutines</li>
<li> How to refactor code reliant on `stdin` / `stdout` into testable code reliant on the `Reader` / `Writer` interfaces</li>
<li> How to test time-dependent code</li>
</ul>
<p>I definitely learned something from testing this gophercise and explaining it in this post, and I hope you learned something as well!</p>
<p>Happy testing
-Kasper</p>


      </main>

      <footer class="pb-4 pt-7 dark:bg-gray-800 dark:text-white text-center text-sm">Kasper Dissing Bargsteen © 2021</footer>
    </div>

    <!-- Current page: /posts/testinggophercise_one/ -->
    <script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>
  </body>
  <script>
    function toggleDarkMode() {
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        localStorage.theme = 'light';
        document.documentElement.classList.remove('dark')
      } else {
        localStorage.theme = 'dark';
        document.documentElement.classList.add('dark')
      }
    }
  </script>
</html>
